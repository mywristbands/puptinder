//
//  Login.swift
//  PupTinder
//
//  Created by Hajra Mobashar on 11/9/19.
//  Copyright Â© 2019 ecs189e. All rights reserved.
//

import UIKit
import Firebase
import FirebaseDatabase

class Login: UIViewController {
    @IBOutlet weak var emailField: UITextField!
    @IBOutlet weak var passwordField: UITextField!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        /* At the moment, the following code serves for testing basic CRUD operations
           and is used for writing security rules. This code serves no purpose to the actual logic rn.
         
        // Get reference to Firestore Database
        let db = Firestore.firestore()
        
        // Adding a document, collection can exist but if not then it will be created, document IDs autogenerated
        /* db.collection("profiles").addDocument(data: ["picture":"file_path_string","name":"Tammy","breed":"Human","size":"S","bio":"I am a person","traits":"trait1","characteristics":"characteristic1"])
        */
        // Access document ID for a doc using document() method and access documentID property
        let newDoc = db.collection("profiles").document("named_doc")
        // setData() will replace data, use merge when append
        newDoc.setData(["picture":"file_path_string2","name":"Tammy2","breed":"Human2","size":"S2","bio":"I am a person 2","traits":["trait2"],"characteristics":["characteristic2"],"id":newDoc.documentID])
        // Delete document with delete() or delete field with updateData() with FieldValue.delete()
        // Read with getDocument, or getDocuments, or a subset using where()
        db.collection("profiles").document("named_doc").getDocument { (document, error) in
            if error == nil {
                // Check if document exists
                if let doc = document, doc.exists {
                    let documentData = doc.data()
                    print(documentData)
                }
            }
        }
        */
    }
    
    @IBAction func loginPressed() {
        guard let email = emailField.text, let password = passwordField.text else {
            return
        }
        Api.auth.login(email: email, password: password) { (error) in
            if error != nil {
                // TODO: Deal with the error
            } else {
                // TODO: Login was a success, so Segueway to the next screen!
                
                // These functions are just for testing; remove after profile stuff is all working!
                //self.uploadProfile()
                //self.testGetProfile()
                //self.testingFunction()
                //print("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")
                //self.testingFunctionMatches()
                //self.testingFunctionMatchesArray()
            }
        }
    }
    
    // This function is just for testing; remove after profile stuff is all working!
    func uploadProfile(){
        Api.profiles.uploadProfile(profile: Profile(picture: UIImage(named: "test_dog")!, name: "Elias", gender: "male", breed: "SuperHuman", size: "small", bio: "Why isn't upload profile working?", traits: ["impatient"], characteristics: ["In my room", "here"])) {
            (error) in
            if (error != nil) {
                print(error!)
            }
        }
    }
    // This function is just for testing; remove after profile stuff is all working!
    func testGetProfile() {
        Api.profiles.getProfile { (profile, error) in
            if let error = error {
                print(error)
            } else {
                guard let profile = profile else {return}
                print(profile.name, profile.bio, profile.breed, profile.size, profile.characteristics, profile.traits)
                let imageView = UIImageView(image: profile.picture)
                imageView.frame = CGRect(x: 0, y: 0, width: 100, height: 200)
                self.view.addSubview(imageView)

            }
        }
    }
    
    // This function is just for testing; remove after profile stuff is all working!
    func testingFunction() {
        Api.profiles.getProfileOf(uid: "HfPac5bFtmODf4YSZuuPZ76BBgH2") { (profile, error) in
            if let error = error {
                print(error)
            } else {
                guard let profile = profile else {return}
                print(profile.name, profile.bio, profile.breed, profile.size, profile.characteristics, profile.traits)
                let imageView = UIImageView(image: profile.picture)
                imageView.frame = CGRect(x: 0, y: 0, width: 100, height: 200)
                self.view.addSubview(imageView)
            }
        }
    }
    
    // This function is just for testing matches; remove after matches functions are all working!
    func testingFunctionMatches() {
        Api.matches.getPotentialMatch{ (profile, error) in
            if let error = error {
                print(error)
            } else {
                guard let profile = profile else {return}
                print(profile.name, profile.bio, profile.breed, profile.size, profile.characteristics, profile.traits)
                let imageView = UIImageView(image: profile.picture)
                imageView.frame = CGRect(x: 0, y: 0, width: 100, height: 200)
                self.view.addSubview(imageView)
            }
        }
    }
    
    // This function is just for testing matches array; remove after matches functions are all working!
    func testingFunctionMatchesArray() {
        Api.matches.getMatches{ (profiles, error) in
            if let error = error {
                print(error)
            } else {
                guard let profiles = profiles else {return}
                print("Print profiles now ... ")
                let profile = profiles[0]
                let profile1 = profiles[1]
                print(profile.name, profile.bio, profile.breed, profile.size, profile.characteristics, profile.traits)
                print(profile1.name, profile1.bio, profile1.breed, profile1.size, profile1.characteristics, profile1.traits)
                let imageView = UIImageView(image: profile.picture)
                imageView.frame = CGRect(x: 0, y: 0, width: 100, height: 200)
                self.view.addSubview(imageView)
            }
        }
    }
    
    // This serves as a gateway to the Matches feature during development
    @IBAction func goToMatchesAndConversations() {
        let storyboard = UIStoryboard(name: "Main", bundle: nil)
        let messengerVC = storyboard.instantiateViewController(withIdentifier: "MatchesAndConversations") as! MatchesAndConversations
        messengerVC.modalPresentationStyle = .fullScreen
        self.present(messengerVC, animated: true, completion: nil)
    }
    
}

